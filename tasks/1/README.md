# Go Grabber

[Практика взята с Habrahabr](https://habrahabr.ru/post/197598/) 

[Спасибо Ddread за практику](https://habrahabr.ru/users/Dreadd/)

Про язык Go от команды Google слышали, наверное, все. А вот пробовали далеко не все, и очень зря — общение с ~~сусликами~~ Go это море удовольствия, в чем я недавно убедился на собственном опыте.
Начинать знакомство с новым языком забавнее всего на жизненном примере, поэтому я, не долго думая, взял первую попавшуюся задачу “из жизни, самой первостепенной важности”:

Есть в интернете сайт http://vpustotu.ru на котором любой желающий может анонимно высказаться о наболевшем. Все высказывания (в дальнейшем буду называть их “цитатами”) сначала попадают в модерацию (аналог “бездны” башорга), где посетители могут оценить полет мысли и проголосовать за цитату в стиле “Ого!” или “Ерунда!”. На странице модерации (http://vpustotu.ru/moderation/) нам показывают случайную цитату, ссылки голосования и ссылку “Еще”, которая ведет на эту же страницу. Пощелкайте, это все очень просто.

**И вот возникла задача** – срочно, под покровом темноты, загрузить себе полный дамп всех цитат на модерации для дальнейшего секретного исследования. Не будем оценивать житейскую ценность и степень идиотизма задачи, а рассмотрим её с технической точки зрения:

В разделе модерации нет прямых ссылок на определенную цитату, единственный способ получить новую цитату – обновить страницу (или перейти по ссылке “еще”, что одно и тоже). Причем вполне возможны повторы, что легко обнаруживается после пары минут агрессивного кликинга.

Таким образом нужна программа, которая:

* Должна последовательно обновлять и парсить (разбирать) страницу, записывая цитату.
* Должна уметь отбрасывать дубликаты.

Логично, что мы понятия не имеем все ли цитаты загружены, но об этом можно косвенно догадаться по большому количеству повторно полученных цитат подряд. Поэтому дополним:

* Должна останавливаться не только по команде, но и по достижению определенного числа “повторов”, например 500!
* Так как это, скорее всего, займет некоторое время: необходимо уметь продолжить “с места на котором остановились” после закрытия.
* Ну и раз уж все-таки это надолго – пусть делает свое грязное дело в несколько потоков. Хорошо-бы в целых 4 потока (или даже 5!).
* И отчитывается об успехах в консоль каждые, скажем, 10 секунд.
* А все эти параметры пускай принимает из аргументов командной строки!

Ну, вроде все понятно. Пусть программа ведет два файла – с цитатами и с некими хешами этих цитат, чтобы не повторяться, и перечитывает файл в начале каждого запуска. Ну а дальше в цикле разбирает страницу, выдергивая все новые и новые откровения, пока не получит ctrl-c по лбу или же не встретит определенное количество повторов. Задача ясна, план есть – поехали!

Задачи:
* Задача 1: Подготовка #1
* Задача 2: Граббер #2
* Задача 3: Цикл #3

[Код программы целиком на Pastbin.com](http://pastebin.com/TJjBLLe5)

Если вас заинтересовал Go и его возможности — вот несколько мест, которые стоит посетить:

[tour.golang.org](tour.golang.org) — Онлайн тур по языку, редактирование кода прямо в браузере — очень увлекательно.

[gobyexample.com](gobyexample.com) — Примеры решения типовых задач

[golang.org/ref/spec](golang.org/ref/spec) — Спецификация языка

[golang.org/doc/effective_go.html](golang.org/doc/effective_go.html) — Статья на тему «а теперь мы со всей этой фигней попробуем взлететь» — как правильно взлетать и летать на Go

Группы Google посвященные Go — "https://groups.google.com/forum/#!forum/golang-nuts" и "https://groups.google.com/forum/#!forum/golang-ru"

[godoc.org](godoc.org)— Поиск по пакетам Go и их документации, причем как по встроенным так и по сторонним, отличная антивелосипедная вещь!

Удачи!
