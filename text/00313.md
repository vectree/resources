## Менеджер зависимостей

Существует много библиотек, фреймворков и компонентов PHP на выбор. Ваш проект, скорее всего, будет использовать некоторые из них &mdash; это и есть зависимости проекта. До недавнего времени в PHP не существовало удобного способа для управления зависимостями проекта. Даже если вы управляете ими вручную, вам приходилось беспокоиться об автозагрузчиках. Больше это не требуется.

В настоящее время существует две основные системы управления пакетами для PHP &mdash; Composer и PEAR. Какая из них подходит именно вам? Ответ &mdash; обе.

 * Используйте **Composer** для управления зависимостями одного проекта.
 * Используйте **PEAR** для управления зависимостями всех проектов во всей вашей системе.

В общем, пакеты Composer будут доступны только в проектах, для которых вы явно укажете его использование, тогда как пакеты PEAR будут доступны во всех ваших PHP проектах. PEAR, на первый взгляд, может показаться более простым подходом, но есть преимущества в использовании подхода «проект-к-проекту» для зависимостей.

### Composer и Packagist

Composer является **блестящим** менеджером зависимостей для PHP. Укажите список зависимостей вашего проекта в файле `composer.json` и, с помощью нескольких простых команд, Composer автоматически скачает зависимости вашего проекта и установит для вас автозагрузку.

На данный момент существует много PHP библиотек, которые совместимы с Composer, готовых для использования в вашем проекте. Список этих «пакетов» есть на [Packagist][1], официальном репозитории для Composer-совместимых PHP библиотек.

#### Как установить Composer

Вы можете установить Composer локально (в вашей текущей рабочей директории; хотя это не рекомендуется) или глобально (например /usr/local/bin). Предположим, вы хотите установить Composer локально. Из корневой директории вашего проекта выполните:

    curl -s https://getcomposer.org/installer | php

Это позволит загрузить файл `composer.phar` (бинарный PHP-архив). Вы можете запустить его, используя `php` для управления зависимостями вашего проекта. <strong>Обратите внимание:</strong> Если вы скачаете код напрямую в ваш интерпретатор, пожалуйста, сперва прочитайте код онлайн, для подтверждения его безопасности.

#### Как установить Composer (вручную)

Ручная установка Composer &mdash; это продвинутая техника; однако, существуют причины, по которым разработчик может предпочесть именно этот метод использованию интерактивной установки. Интерактивная установка проверяет настройки PHP, чтобы подтвердить, что:

- Используется необходимая версия PHP
- Файлы `.phar` могут быть верно выполнены
- Определенные права на каталог достаточны
- Не установлены конфликтные расширения
- Установлены необходимые настройки `php.ini`

В случае, если ни одно из этих условий не соблюдено, вы должны принять решение стоит ли идти на такой компромисс. Ниже описано, как установить Composer вручную:

    curl -s http://getcomposer.org/composer.phar -o $HOME/local/bin/composer
    chmod +x $HOME/local/bin/composer

Путь `$HOME/local/bin` (или другой каталог, выбранный вами) должен находиться в вашей переменной окружения `$PATH`. Это позволит быть доступной команде `composer`.

Если вы прочтете документацию Composer, которая гласит, что нужно запускать Composer с помощью команды `php composer.phar install`, вы можете заменить эту команду на:

    composer install

#### Как объявить и установить зависимости

Composer продолжает следить за зависимостями вашего проекта в файле `composer.json`. Вы можете управлять им вручную, если вам нравится, или же использовать сам Composer. Команда `php composer.phar require` добавляет зависимость в проект и, если в каталоге нет файла `composer.json`, он будет создан. Далее мы рассмотрим пример, который добавляет [Twig][2], как зависимость вашего проекта. Запустите это в корневой директории вашего проекта, куда вы загружали `composer.phar`:

	php composer.phar require twig/twig:~1.8

Аналогично команда `php composer.phar init`	проведет вас через создание полного файла `composer.json` для вашего проекта. Есть и другой путь, когда вы создадите файл `composer.json` вы можете сказать Composer, чтобы он скачал все ваши зависимости в папку `vendors/`. Это также применимо для проектов, которые вы загрузили и которые предоставляют файл `composer.json`:

    php composer.phar install

Затем добавьте этот код в основной PHP-файл вашего приложения; это укажет PHP использовать автозагрузчик Composer для зависимостей вашего проекта.

```php
<?php
require 'vendor/autoload.php';
```

Теперь вы можете использовать зависимости вашего проекта и они будут автоматически загружаться (по требованию).

### Обновление зависимостей

Composer создает файл `composer.lock` который хранит точную версию каждого пакета, который он загрузил во время первого запуска `php composer.phar install`. Если вы поделились проектом с другими разработчиками и файл `composer.lock` является частью него, то при запуске `php composer.phar install` они получат ту же версию, что и вы. Чтобы обновить ваши зависимости запустите `php composer.phar update`.

Очень удобно гибко указывать требуемые версии. Если вы нуждаетесь в версии ~1.8, что значит "всё что новее 1.8.0, но меньше 2.0.x-dev". Вы также можете использовать шаблон `*`, например `1.8.*`. Теперь команда Composer `php composer.phar update` обновит все ваши зависимости до новейших версий, которые соответствуют указанным ограничениям.

### Проверка ваших зависимостей на безопасность

[Security Advisories Checker][3] является веб-сервисом и инструментом командной строки, оба из которых изучают ваш файл `composer.lock` и сообщают, если есть необходимость в обновлении какой-либо из ваших зависимостей.

* [Подробнее о Composer][4]

[1]: http://packagist.org/
[2]: http://twig.sensiolabs.org
[3]: https://security.sensiolabs.org/
[4]: http://getcomposer.org/doc/00-intro.md

---
isChild: true
---

### PEAR

Другим ветераном среди пакетных менеджеров, которым наслаждаются многие PHP-разработчики, является [PEAR][1]. Он работает практически так же, как и Composer, но имеет несколько важных отличий.

PEAR требует, чтобы каждый пакет имел определенную структуру, это означает, что автор пакета должен подготовить его для использования с PEAR. Использование проекта, который не был подготовлен для работы с PEAR невозможно.

PEAR устанавливает пакеты глобально, что означает то, что после установки, они доступны всем проектам на этом сервере. Это может быть полезно, если много проектов строятся на тех же пакетах с той же версией, но может привести к проблемам, если проекты разрабатывались для разных версий.

#### Как установить PEAR

Вы можете установить PEAR, загрузив установщик phar и выполнив его. Документация PEAR содержит подробную
[инструкцию по установке][2] для каждой операционной системы.

Если вы используете Linux, вы также можете посмотреть наличие PEAR в пакетном менеджере вашего дистрибутива. Debian и Ubuntu, к примеру, содержат информацию о пакете ``php-pear`` в пакетном менеджере apt.

### Как установить пакет

Если пакет существует в [списке пакетов PEAR][3], вы можете установить его, указав официальное название:

    pear install foo

Если пакет выложен на другом канале, вам нужно сначало сделать `discover` этого канала и затем указать его во время установки. Подробнее об этом в [использование каналов][4].

* [Подробнее о PEAR][1]

#### Обработка зависимостей PEAR с Composer

Если вы уже используете [Composer][5] и желаете установить какой-то код из PEAR, вы можете использовать Composer для обработки зависимостей PEAR. Этот пример установит код из `pear2.php.net`:

```json
{
    "repositories": [
        {
            "type": "pear",
            "url": "http://pear2.php.net"
        }
    ],
    "require": {
        "pear-pear2/PEAR2_Text_Markdown": "*",
        "pear-pear2/PEAR2_HTTP_Request": "*"
    }
}
```

Первый раздел `"repositories"` даст понять Composer, что он должен сделать "initialise" (или "discover" в терминологии PEAR) репозиторий pear. Затем секция require укажет именам пакетов префикс, как ниже:

> pear-channel/Package

Префикс "pear" жестко ограничен, чтобы избежать любых конфликтов, так как каналы Pear могут быть схожи с другими поставщиками пакетов например, вместо короткого имени (или полного URL) может быть использовано для объявления в каком канале находится пакет.

Когда код будет установлен он будет доступен в вашей папке vendor и автоматически доступен через автозагрузчик (файл Autoload) Composer.

> vendor/pear-pear2.php.net/PEAR2_HTTP_Request/pear2/HTTP/Request.php

Чтобы использовать этот пакет PEAR просто объявите как ниже:

```php
$request = new pear2\HTTP\Request();
```

* [Подробнее о использовании PEAR с Composer][6]

[1]: http://pear.php.net/
[2]: http://pear.php.net/manual/ru/installation.getting.php
[3]: http://pear.php.net/packages.php
[4]: http://pear.php.net/manual/ru/guide.users.commandline.channels.php
[5]: /#composer_и_packagist
[6]: http://getcomposer.org/doc/05-repositories.md#pear